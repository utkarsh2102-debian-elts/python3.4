
# HG changeset patch
# User Benjamin Peterson <benjamin@python.org>
# Date 1465676202 25200
# Node ID d590114c23940c41f558216f92f9c084d32aa688
# Parent  90e58a77d386e658b76fd097e8a5efb48e7421e4
raise an error when STARTTLS fails

--- a/Lib/smtplib.py
+++ b/Lib/smtplib.py
@@ -696,6 +696,11 @@
             self.ehlo_resp = None
             self.esmtp_features = {}
             self.does_esmtp = 0
+        else:
+            # RFC 3207:
+            # 501 Syntax error (no parameters allowed)
+            # 454 TLS not available due to temporary reason
+            raise SMTPResponseException(resp, reply)
         return (resp, reply)
 
     def sendmail(self, from_addr, to_addrs, msg, mail_options=[],
